<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard ‚Äì Firma</title>

<style>
    body {
        font-family: "Segoe UI", Roboto, Arial;
        background: #f4f7fa;
        margin: 0;
        padding: 15px;
    }

    .container {
        max-width: 900px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    h2 {
        text-align: center;
        margin-top: 0;
        background: linear-gradient(135deg, #00bcd4, #9c27b0);
        padding: 15px;
        color: white;
        border-radius: 8px;
        font-size: 20px;
    }

    .stats {
        display: flex;
        justify-content: space-between;
        margin: 15px 0;
        flex-wrap: wrap;
    }

    .stat-box {
        flex: 1 1 30%;
        background: #f0faff;
        border-left: 4px solid #00bcd4;
        padding: 12px;
        margin: 5px;
        border-radius: 6px;
        text-align: center;
        font-weight: bold;
        color: #333;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #eee;
        text-align: left;
        font-size: 14px;
    }

    th {
        background: #fafafa;
        font-weight: bold;
    }

    .status {
        padding: 6px 10px;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        font-size: 12px;
        display: inline-block;
    }

    .nowy { background: #9c27b0; }
    .kontakt { background: #2196f3; }
    .nie_odbiera { background: #ff9800; }
    .obsluzony { background: #4caf50; }
    .odrzucony { background: #f44336; }

    .loading {
        text-align: center;
        margin: 40px 0;
        font-size: 18px;
        font-weight: bold;
        color: #666;
    }
</style>
</head>
<body>

<div class="container">
    <h2>üìä Dashboard ‚Äì Podsumowanie lead√≥w</h2>

    <div id="loading" class="loading">≈Åadowanie danych...</div>

    <div id="stats" class="stats" style="display:none;">
        <div class="stat-box">Nowe: <span id="stat-nowe">0</span></div>
        <div class="stat-box">W kontakcie: <span id="stat-kontakt">0</span></div>
        <div class="stat-box">Obs≈Çu≈ºone: <span id="stat-obsluzone">0</span></div>
    </div>

    <table id="leads-table" style="display:none;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Data</th>
                <th>Pacjent</th>
                <th>Telefon</th>
                <th>Email</th>
                <th>Cel wizyty</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

</div>

<script>
// ---- CONFIG ----
const SHEET_ID = "1WubNwZuof8s8Udg93k0C9Qgo-VkPXiQT0_7-VeEg81k";
const urlParams = new URLSearchParams(window.location.search);
const sheetName = urlParams.get("firma") || "firma1";

// ---- FETCH GOOGLE SHEETS ----
const url =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

fetch(url)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    const rows = json.table.rows;

    const tbody = document.querySelector("#leads-table tbody");

    let statNowe = 0, statKontakt = 0, statObsluzone = 0;

    rows.forEach(r => {
      const id = r.c[0]?.v || "";
      const data = r.c[1]?.v || "";
      const name = r.c[2]?.v || "";
      const tel = r.c[3]?.v || "";
      const email = r.c[4]?.v || "";
      const cel = r.c[5]?.v || "";
      const status = (r.c[7]?.v || "").toLowerCase();

      // Liczenie statystyk
      if (status === "nowy") statNowe++;
      if (status === "w kontakcie") statKontakt++;
      if (status === "obsluzony") statObsluzone++;

      // Tworzenie wiersza
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${id}</td>
        <td>${data}</td>
        <td>${name}</td>
        <td>${tel}</td>
        <td>${email}</td>
        <td>${cel}</td>
        <td><span class="status ${status.replace(" ", "_")}">${status}</span></td>
      `;

      tbody.appendChild(tr);
    });

    // Pokazanie danych + statystyk
    document.getElementById("loading").style.display = "none";
    document.getElementById("leads-table").style.display = "table";
    document.getElementById("stats").style.display = "flex";

    document.getElementById("stat-nowe").innerText = statNowe;
    document.getElementById("stat-kontakt").innerText = statKontakt;
    document.getElementById("stat-obsluzone").innerText = statObsluzone;

  })
  .catch(err => {
    document.getElementById("loading").innerText = "B≈ÇƒÖd ≈Çadowania danych.";
  });

</script>

</body>
</html>
