<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Status leada</title>

<style>
body {
  font-family: 'Segoe UI', Roboto, Arial, sans-serif;
  background:#f7f8fa;
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.wrapper {
  max-width:600px;
  width:90%;
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
  overflow:hidden;
}

.header {
  background: linear-gradient(135deg, #00bcd4, #9c27b0);
  color:#fff;
  padding:24px;
  text-align:center;
}

.header img {
  width:70px;
  border-radius:16px;
  display:block;
  margin:0 auto 10px;
}

.header h2 {
  margin:0;
  font-size:22px;
}

.content {
  padding:26px 30px;
}

.box {
  background:#f4fbfd;
  border-left:4px solid #00bcd4;
  padding:16px 20px;
  border-radius:6px;
  margin-bottom:20px;
}

.box.data {
  background:#f0faff;
}

.box.script {
  background:#f9f9f9;
  border:1px dashed #ccc;
  font-size:14px;
  color:#555;
}

p {
  margin:6px 0;
  font-size:15px;
}

.meta {
  color:#555;
}

.buttons {
  text-align:center;
  margin:30px 0;
}

.buttons a {
  display:inline-block;
  margin:6px;
  padding:12px 20px;
  border-radius:6px;
  color:white;
  text-decoration:none;
  font-weight:bold;
}

.obs { background:#4caf50; }
.nie { background:#ff9800; }
.odrz { background:#f44336; }

.footer {
  background:#f7f8fa;
  text-align:center;
  padding:14px;
  font-size:12px;
  color:#999;
}
</style>
</head>

<body>

<div class="wrapper" id="app">
  <div class="content">
    â³ ÅÄ…czenie z serweremâ€¦
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzBLTLdMX1DXfLdDjiIit97OWNNaIjdiXqj9_bVtWSdytJAy4x9SvRTZdSP8t3Ysd-7/exec";
const params = new URLSearchParams(window.location.search);
const row = params.get("row");
const token = params.get("token");
const app = document.getElementById("app");

function formatDate(iso) {
  if (!iso) return "-";
  const d = new Date(iso);
  return d.toLocaleString("pl-PL", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit"
  });
}

function showError(msg) {
  app.innerHTML = `
    <div class="content">
      <h3>â›” BÅ‚Ä…d</h3>
      <p style="color:#777">${msg}</p>
    </div>
  `;
}

function render(lead) {
  app.innerHTML = `
    <div class="header">
      <img src="https://scontent-waw2-2.xx.fbcdn.net/v/t39.30808-6/540904522_122143092902741193_6153063326804191448_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=EXFBb3EdkUsQ7kNvwGb2Smp&_nc_oc=Adngi_kLnbg9pQiId6dkbJxk2TSxZhFWngOi9hCe_Ny49faPOIFTWxxq8fgzzJADO7I&_nc_zt=23&_nc_ht=scontent-waw2-2.xx&_nc_gid=w7niD_O83PtXyVLS5FjwZg&oh=00_AfkKwh5kzI8KNfgAR8NLvYEUObCW-JZmOSS3fx9QybdVYg&oe=6949BD8D" alt="AdFlow">
      <h2>Status kontaktu z pacjentem</h2>
    </div>

    <div class="content">

      <div class="box">
        <p>ğŸ†” <strong>Lead ID:</strong> ${lead["Id."]}</p>
        <p>ğŸ“… <strong>Data zgÅ‚oszenia:</strong> ${formatDate(lead["Data"])}</p>
        <p class="meta">ğŸ“ <strong>Status:</strong> ${lead["Obecny status"] || "nowy"}</p>
      </div>

      <div class="box data">
        <p><strong>ğŸ§¾ ImiÄ™ i nazwisko:</strong> ${lead["ImiÄ™ Nazwisko"]}</p>
        <p><strong>ğŸ“ Telefon:</strong> ${lead["Nr tel"]}</p>
        <p><strong>âœ‰ï¸ Email:</strong> ${lead["Email"] || "-"}</p>
        <p><strong>ğŸ¦· Cel wizyty:</strong> ${lead["Pytanie 1 (cel wizyty)"]}</p>
        <p><strong>ğŸ’¬ Informacje:</strong><br>${lead["Pytanie 2 (Informacje)"] || "-"}</p>
      </div>

      <div class="box script">
        ğŸ’¬ <strong>Sugestia rozmowy:</strong><br>
        â€DzieÅ„ dobry, dzwoniÄ™ z gabinetu stomatologicznego.  
        WidzÄ™, Å¼e zgÅ‚osiÅ‚/a siÄ™ Pan/Pani w sprawie
        <strong>${lead["Pytanie 1 (cel wizyty)"]}</strong>.
        Jaki termin wizyty byÅ‚by dla Pana/Pani dogodny?â€
      </div>

      <div class="buttons">
        <a class="obs" onclick="updateStatus('obsluzony')">âœ” Lead obsÅ‚uÅ¼ony</a>
        <a class="nie" onclick="updateStatus('nie_odbiera')">ğŸ“ Nie odbiera</a>
        <a class="odrz" onclick="updateStatus('odrzucony')">âŒ Lead odrzucony</a>
      </div>

    </div>

    <div class="footer">
      System AdFlow Â· automatyczna obsÅ‚uga leadÃ³w
    </div>
  `;
}

function updateStatus(status) {
  fetch(`${API_URL}?row=${row}&token=${token}&status=${status}`, {
    method: "POST",
    mode: "no-cors"
  });

  app.innerHTML = `
    <div class="content">
      <h3>âœ… Status zapisany</h3>
      <p style="color:#777">MoÅ¼esz zamknÄ…Ä‡ to okno</p>
    </div>
  `;
}

if (!row || !token) {
  showError("NieprawidÅ‚owy link");
} else {
  fetch(`${API_URL}?row=${row}&token=${token}`)
    .then(r => r.json())
    .then(d => d.success ? render(d.lead) : showError("Brak dostÄ™pu do leada"))
    .catch(() => showError("BÅ‚Ä…d poÅ‚Ä…czenia z API"));
}
</script>

</body>
</html>
