<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Status leada</title>

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f7f8fa;
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container {
  background:#fff;
  padding:22px;
  border-radius:12px;
  width:90%;
  max-width:460px;
  box-shadow:0 4px 15px rgba(0,0,0,.05);
}
.section {
  background:#f9fafb;
  padding:14px 16px;
  border-radius:8px;
  margin-bottom:14px;
}
.section h4 {
  margin:0 0 8px;
  font-size:14px;
  color:#666;
}
p {
  margin:6px 0;
  font-size:15px;
}
.meta {
  font-size:14px;
  color:#555;
}
.status {
  font-weight:bold;
}
a {
  display:block;
  margin:10px 0;
  padding:12px;
  border-radius:6px;
  color:white;
  text-decoration:none;
  font-weight:bold;
  text-align:center;
}
.obs { background:#4caf50; }
.nie { background:#ff9800; }
.odrz { background:#f44336; }
</style>
</head>

<body>

<div class="container" id="app">
  <p>â³ ÅÄ…czenie z serweremâ€¦</p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzBLTLdMX1DXfLdDjiIit97OWNNaIjdiXqj9_bVtWSdytJAy4x9SvRTZdSP8t3Ysd-7/exec";

const params = new URLSearchParams(window.location.search);
const row = params.get("row");
const token = params.get("token");
const app = document.getElementById("app");

function showError(msg = "Brak dostÄ™pu do leada") {
  app.innerHTML = `
    <h3>â›” BÅ‚Ä…d</h3>
    <p style="color:#777">${msg}</p>
  `;
}

function render(lead) {
  app.innerHTML = `
    <div class="section">
      <h4>ğŸ“Œ Informacje o leadzie</h4>
      <p class="meta">ğŸ†” <strong>ID:</strong> ${lead["Id."]}</p>
      <p class="meta">ğŸ“… <strong>Data zgÅ‚oszenia:</strong> ${lead["Data"]}</p>
      <p class="meta">ğŸ¯ <strong>Kampania:</strong> ${lead["Nazwa Kampanii"] || "-"}</p>
      <p class="meta status">ğŸ“ <strong>Status:</strong> ${lead["Obecny status"] || "nowy"}</p>
    </div>

    <div class="section">
      <h4>ğŸ‘¤ Dane pacjenta</h4>
      <p><strong>ImiÄ™ i nazwisko:</strong> ${lead["ImiÄ™ Nazwisko"]}</p>
      <p><strong>Telefon:</strong> ${lead["Nr tel"]}</p>
      <p><strong>Email:</strong> ${lead["Email"] || "-"}</p>
    </div>

    <div class="section">
      <h4>ğŸ¦· Informacje medyczne</h4>
      <p><strong>Cel wizyty:</strong> ${lead["Pytanie 1 (cel wizyty)"]}</p>
      <p><strong>Dodatkowe informacje:</strong><br>${lead["Pytanie 2 (Informacje)"] || "-"}</p>
    </div>

    <a class="obs" onclick="updateStatus('obsluzony')">âœ” Lead obsÅ‚uÅ¼ony</a>
    <a class="nie" onclick="updateStatus('nie_odbiera')">ğŸ“ Nie odbiera</a>
    <a class="odrz" onclick="updateStatus('odrzucony')">âŒ Lead odrzucony</a>
  `;
}

function updateStatus(status) {
  fetch(`${API_URL}?row=${row}&token=${token}&status=${status}`, {
    method: "POST",
    mode: "no-cors"
  });

  app.innerHTML = `
    <h3>âœ… Status zapisany</h3>
    <p style="color:#777">MoÅ¼esz zamknÄ…Ä‡ to okno</p>
  `;
}

if (!row || !token) {
  showError("NieprawidÅ‚owy link");
} else {
  fetch(`${API_URL}?row=${row}&token=${token}`)
    .then(r => r.json())
    .then(d => {
      if (!d.success) showError("Brak dostÄ™pu do leada");
      else render(d.lead);
    })
    .catch(() => showError("BÅ‚Ä…d poÅ‚Ä…czenia z API"));
}
</script>

</body>
</html>
