<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Status leada</title>

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f7f8fa;
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container {
  background:#fff;
  padding:22px;
  border-radius:12px;
  width:90%;
  max-width:420px;
  box-shadow:0 4px 15px rgba(0,0,0,.05);
  text-align:center;
}
a {
  display:block;
  margin:10px 0;
  padding:12px;
  border-radius:6px;
  color:white;
  text-decoration:none;
  font-weight:bold;
}
.obs { background:#4caf50; }
.nie { background:#ff9800; }
.odrz { background:#f44336; }
</style>
</head>

<body>
<div class="container" id="app">
  <p>â³ ÅÄ…czenie z serweremâ€¦</p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbybSOz5NeBfEXy6FOYqakmckMP6Ul5m9V6qnt6nZrWaDJpPe6UX-YJPDZluNgkfkfJi/exec";

const params = new URLSearchParams(location.search);
const row = params.get("row");
const token = params.get("token");

const app = document.getElementById("app");

if (!row || !token) {
  app.innerHTML = "<h3>â›” NieprawidÅ‚owy link</h3>";
} else {
  fetch(`${API_URL}?row=${row}&token=${token}`)
    .then(r => r.json())
    .then(d => {
      if (!d.success) {
        app.innerHTML = "<h3>â›” Brak dostÄ™pu do leada</h3>";
        return;
      }

      const l = d.lead;

      app.innerHTML = `
        <h3>${l["ImiÄ™ Nazwisko"]}</h3>
        <p><strong>ğŸ“ Telefon:</strong><br>${l["Nr tel"]}</p>
        <p><strong>âœ‰ï¸ Email:</strong><br>${l["Email"]}</p>
        <p><strong>ğŸ¦· Cel wizyty:</strong><br>${l["Pytanie 1 (cel wizyty)"]}</p>
        <p><strong>ğŸ’¬ Informacje:</strong><br>${l["Pytanie 2 (Informacje)"]}</p>

        <a class="obs" onclick="update('obsluzony')">âœ” Lead obsÅ‚uÅ¼ony</a>
        <a class="nie" onclick="update('nie_odbiera')">ğŸ“ Nie odbiera</a>
        <a class="odrz" onclick="update('odrzucony')">âŒ Lead odrzucony</a>
      `;
    })
    .catch(() => {
      app.innerHTML = "<h3>âš ï¸ BÅ‚Ä…d poÅ‚Ä…czenia z API</h3>";
    });
}

function update(status) {
  fetch(API_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: `row=${row}&token=${token}&status=${status}`
  })
  .then(r => r.json())
  .then(d => {
    if (d.success) {
      app.innerHTML = "<h3>âœ… Status zapisany</h3>";
    } else {
      app.innerHTML = "<h3>â° MinÄ…Å‚ czas edycji</h3>";
    }
  });
}
</script>
</body>
</html>
