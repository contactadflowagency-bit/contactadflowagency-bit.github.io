<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Status leada</title>

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f7f8fa;
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container {
  background:#fff;
  padding:22px;
  border-radius:12px;
  width:90%;
  max-width:420px;
  box-shadow:0 4px 15px rgba(0,0,0,.05);
  text-align:center;
}
a {
  display:block;
  margin:10px 0;
  padding:12px;
  border-radius:6px;
  color:white;
  text-decoration:none;
  font-weight:bold;
}
.obs { background:#4caf50; }
.nie { background:#ff9800; }
.odrz { background:#f44336; }
</style>
</head>

<body>
<div class="container" id="app">
  <p>â³ ÅÄ…czenie z serweremâ€¦</p>
</div>

<script>
const API_URL = "TU_WKLEJ_LINK_DO_WEB_APP_APPS_SCRIPT";

const params = new URLSearchParams(window.location.search);
const row = params.get("row");
const token = params.get("token");

function showError(msg = "Brak dostÄ™pu do leada") {
  document.getElementById("loadingSection").innerHTML = `
    <h3>â›” BÅ‚Ä…d</h3>
    <p style="color:#777">${msg}</p>
  `;
}

function render(lead) {
  document.getElementById("loadingSection").innerHTML = `
    <h3>ğŸ‘¤ ${lead["ImiÄ™ Nazwisko"]}</h3>
    <p><strong>Telefon:</strong> ${lead["Nr tel"]}</p>
    <p><strong>Email:</strong> ${lead["Email"]}</p>
    <p><strong>Cel wizyty:</strong> ${lead["Pytanie 1 (cel wizyty)"]}</p>

    <div class="manual-buttons">
      <a class="obs" onclick="updateStatus('obsluzony')">âœ” Lead obsÅ‚uÅ¼ony</a>
      <a class="nie" onclick="updateStatus('nie_odebral')">ğŸ“ Nie odbiera</a>
      <a class="odrz" onclick="updateStatus('odrzucony')">âŒ Lead odrzucony</a>
    </div>
  `;
}

function updateStatus(status) {
  fetch(`${API_URL}?row=${row}&token=${token}&status=${status}`, {
    method: "POST",
    mode: "no-cors"
  });

  document.body.innerHTML = `
    <h3 style="text-align:center">âœ… Status zapisany</h3>
    <p style="text-align:center;color:#777">MoÅ¼esz zamknÄ…Ä‡ to okno</p>
  `;
}

if (!row || !token) {
  showError("NieprawidÅ‚owy link");
} else {
  fetch(`${API_URL}?row=${row}&token=${token}`)
    .then(r => r.json())
    .then(d => {
      if (!d.success) showError("Brak dostÄ™pu do leada");
      else render(d.lead);
    })
    .catch(() => showError("BÅ‚Ä…d poÅ‚Ä…czenia z API"));
}
</script>

</body>
</html>
